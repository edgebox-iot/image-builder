---
- name: 'Provision Image'
  hosts: 'all'
  become: true

  tasks:
    - name : Install dev dependencies
      ansible.builtin.apt:
        pkg:
        - vim
        - nano
        - jq
        - yq
    - name: Install base dependencies
      ansible.builtin.apt:
        pkg:
        - nano
        - curl
        - git
        - libffi-dev
        - libssl-dev
        - python3
        - python3-pip
        - samba
        - samba-common-bin
        - avahi-daemon
        - avahi-utils

    - name: Add system user
      ansible.builtin.user:
        name: system
        password: '{{ lookup("env", "SYSTEM_PW") }}'

    - name: Add Docker GPG apt Key
      apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present

    - name: Add Docker Repository
      apt_repository:
        repo: deb https://download.docker.com/linux/ubuntu focal stable
        state: present

    - name: Update apt and install docker-ce
      apt:
        name: docker-ce
        state: latest
        update_cache: true

    - name: Install Docker Module for Python
      pip:
        name: docker

    - name: Install docker-compose
      ansible.builtin.pip:
        name: docker-compose

    - name: Install go-lang
      ansible.builtin.import_role:
        name: abdennour.golang
      vars:
        golang_version: '1.16'
